<%- include('../layouts/user/lyHeader.ejs') %>

<!-- Button trigger modal -->

  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLabel">Add Address</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
                <!-- <div class="tab-pane fade" id="account-info" role="tabpanel"> -->
                    <div class="myaccount-content p-4">
                        <div class="account-details-form">
                            <form  action="/addAddress" method="post" onsubmit="return validateAddress(8)">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="first-name" class="required" placeholder="Enter name">Name <span>*</span></label>
                                            <input type="text" id="first-name" name="name" required />
											<div id="nameError" class="text-danger "></div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required" placeholder="Enter Phone no.">Mobile Number <span>*</span></label>
                                            <input type="text" id="mobile-no" name="phone" required />
											<div id="mobileError" class="text-danger "></div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required" placeholder="Enter locality">locality <span>*</span></label>
                                            <input type="text" id="localitys" name="locality" required />
											<div id="localityError" class="text-danger "></div>
                                        </div>
                                    </div>
									
									
                                    <div class="col-lg-6">
										<div class=" single-input-item">
											<label for="first-name" class="required" placeholder="Enter Postal code">Pincode <span>*</span></label>
                                            <input type="text" id="pincodes" name="pincode" required/>
											<div id="pincodeError" class="text-danger "></div>
                                        </div>
                                    </div>
									
								</div>
                             
                                <div class="  single-input-item">
                                    <label for="display-name"class="required">Address <span>*</span></label>
                                    <textarea type="text "id="address" rows="3" placeholder="Enter full address"  name="place" required  style="width: 32vw;" ></textarea>
									<div id="addressError" class="text-danger "></div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="first-name" class="required" placeholder="Enter City">City <span>*</span></label>
                                            <input type="text" id="citys" name="city" required />
											<div id="cityError" class="text-danger "></div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required">State <span>*</span></label>
                                            <input type="text" id="states" name="state" required />
											<div id="stateError" class="text-danger "></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="single-input-item">
                                    <button class="btn btn-dark "style="border-radius: 20px;" >Add</button> 
                                </div>
                            </form>
			</div>
			</div>
			</div>
	  </div>
	</div>
  </div>


  <!-- Modal 2 -->
  <div class="modal fade" id="example" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLabel">Add Address</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
                <!-- <div class="tab-pane fade" id="account-info" role="tabpanel"> -->
                    <div class="myaccount-content p-4">
                        <div class="account-details-form">
                            <form id="editAddressForm" action="/editaddress" method="post">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="single-input-item">
                                            <label for="first-name" class="required" >Name <span>*</span></label>
                                            <input type="text"  name="name" id="name"/>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required" placeholder="Enter Phone no.">Mobile Number <span>*</span></label>
                                            <input type="text" name="phone" id="phone" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required" placeholder="Enter locality">locality <span>*</span></label>
                                            <input type="text" name="locality" id="locality" />
                                        </div>
                                    </div>
									
									
                                    <div class="col-lg-6">
										<div class=" single-input-item">
											<label for="first-name" class="required" placeholder="Enter Postal code">Pincode <span>*</span></label>
                                            <input type="text"  name="pincode" id="pincode" />
                                        </div>
                                    </div>
									
								</div>
                             
                                <div class="  single-input-item">
                                    <label for="display-name"class="required">Address <span>*</span></label>
                                    <textarea type="text" cols="60" rows="3" placeholder="Enter full address" id="place"  name="place"   ></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="first-name" class="required" placeholder="Enter City">City <span>*</span></label>
                                            <input type="text" name="city" id="city" />
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="  single-input-item">
                                            <label for="last-name" class="required">State <span>*</span></label>
                                            <input type="text" name="state" id="state" />
                                        </div>
                                    </div>
                                </div>
                                <div class="single-input-item">
                                    <button class="btn btn-dark "style="border-radius: 20px;" >Save</button> 
                                </div>
								<input type="hidden" name="id" id="id">
                            </form>
			</div>
			</div>
			</div>
	  </div>
	</div>
  </div>
	








		<!-- WRAPPER START -->
		<div class="wrapper bg-dark-white">

			<!-- HEADER-AREA START -->
			<%- include('../layouts/user/Header.ejs') %>
			<!-- HEADER-AREA END -->
			<!-- Mobile-menu start -->
			<%- include('../layouts/user/mobile.ejs') %>
			<!-- Mobile-menu end -->
			<!-- HEADING-BANNER START -->
			<div class="heading-banner-area position-relative  overlay-bg">
				<img src="/image/back.jpg" class="position-absolute object-fit-cover " style="width: 100%; height: 100%;object-fit: cover; " alt="">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<div class="heading-banner">
								<div class="heading-banner-title">
									<h2>My Profile</h2>
								</div>
								<div class="breadcumbs pb-15">
									<ul>
										<li><a href="/">Home</a></li>
										<li>My Profile</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="text-center ">
				<h5><%=locals.msg %></h5>
			</div>
            <div class="page-content first">
                <div class="dashboard" >
                    <div class="container">
                        <div class="row" >
                            <aside class="col-md-4 col-lg-3 first-side" >
                                <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist" >
                                    <li class="nav-item">
                                        <a class="nav-link active" id="tab-dashboard-link" data-toggle="tab" href="#tab-dashboard" role="tab" aria-controls="tab-dashboard" aria-selected="true">Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-orders-link" data-toggle="tab" href="#tab-orders" role="tab" aria-controls="tab-orders" aria-selected="false">Orders</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-downloads-link" data-toggle="tab" href="#tab-downloads" role="tab" aria-controls="tab-downloads" aria-selected="false">Change Password</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-address-link" data-toggle="tab" href="#tab-address" role="tab" aria-controls="tab-address" aria-selected="false">Address</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-account-link" data-toggle="tab" href="#tab-account" role="tab" aria-controls="tab-account" aria-selected="false">Wallet</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="tab-account-link" data-toggle="tab" href="#tab-coupon" role="tab" aria-controls="tab-coupon" aria-selected="false">Coupon</a>
                                    </li>
									<li class="nav-item">
                                        <a class="nav-link" id="tab-Wishlist-link" data-toggle="tab" href="#tab-Wishlist" role="tab" aria-controls="tab-Wishlist" aria-selected="false">Wishlist</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/logout">Sign Out</a>
                                    </li>
                                </ul>
                            </aside><!-- End .col-lg-3 -->
            <style>
				.nav-item{
					background-color: #F6F6F6;
					
				}
				.nav-link{
					background-color:white;
				}
			</style>
                            <div class="col-md-8 col-lg-9">
                                <div class="tab-content">
                                    <div class="tab-pane fade show active user-profile" id="tab-dashboard" role="tabpanel" aria-labelledby="tab-dashboard-link ">
                                     <div class="user-profile p-4 ">
                                        <form action="/userEdit" method="post">
                                        <div>
                                            <input name="name" type="text" value="<%=Data.name %>">
                                        </div>
                                        <div class="d-flex justify-content-between ">
                                                <input  style="width: 27vw;" type="text" value="<%=Data.email %>">
                                             
                                                <input type="text" name="phone" style="width: 27vw;" type="text" value="<%=Data.phone %>">
                                        </div>
                                            <div class="d-flex justify-content-center p-5  ">
                                              </a>  <button class="button ">Edit</button>
                                            </div>
                                            <input type="hidden" name="id" value="<%=Data._id %>">
                                        </form>
                                     
                                     </div>
									 <br>
								
									 <div class="refferal p-3 d-flex  justify-content-center ">
										<div class="refferalCode p-2 ">
											<p>Refferal Code: <span><%=Data.refferalId %></span></p>
										</div>
									 </div>
                                    </div><!-- .End .tab-pane -->
            
                                    <div class="tab-pane fade" id="tab-orders" role="tabpanel" aria-labelledby="tab-orders-link">
										<div class="card border shadow-none">
											<div class=" card-body">
													<% orderPending?.forEach((Pending)=>{ %>
													<% console.log(Pending.paymentStatus) %>
													<% if(Pending?.paymentStatus=="Pending"&&Pending?.payment=='Online Payment'){ %>
											

														
													
													<div class="row mb-5 ">
													<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
														<div class="flex-grow-1 align-self-center overflow-hidden">
															<div>
																<h5 class="text-truncate ">#<%=Pending.OrderId %></h5>
															
									
															</div>
														</div>
														
													
													</div>
												
												
	
													<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
														
														<div class="flex-grow-1 align-self-center overflow-hidden">
															<div>
																<h5 class="text-truncate ">₹ <%=Pending.orderAmount %></h5>
															
									
															</div>
														</div>
														
														<div class="flex-shrink-0 ms-2">
															<ul class="list-inline mb-0 font-size-16">
																<li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Remove">
																	<a href="#" class="text-muted px-1">
																		<i class="mdi mdi-trash-can-outline"></i>
																	</a>
																</li>
																<li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Add Wishlist">
																	<a href="#" class="text-muted px-1">
																		<i class="mdi mdi-heart-outline"></i>
																	</a>
																</li>
															</ul>
														</div>
													</div>
	
	
													<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
														<div class="me-4">
															<img src="assets/images/product/img-3.png" alt="" class="avatar-lg">
														</div>
														<div class="flex-grow-1 align-self-center overflow-hidden">
															<div>
																<form id="myFormRepayment" action="/orderRepaymet" method="post">
																	<div class="col-md-4 addButton">
																		<button class="butt" type="button"  onclick="Repayment('<%=Pending.orderAmount%>')">Repayment</button>
																	</div>
																	<input type="hidden" name="orderId" value="<%=Pending.OrderId %>">
																	<input type="hidden" name="status" id="Status" value="">
															</form>
															</div>
														</div>
													
													</div>
													
													<br>
													<br>
												</div>
			
											
												
												<% } %>
												<% }) %>
												</div>
	
											</div>
										<div class="card border shadow-none">
											<div class=" card-body">
												
												<%orders.forEach((order)=>{ %>
													<% order.products.forEach((orde)=>{ %>
												<div class="row mb-5 ">
												<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
													<div class="me-4">
														<a href="/myOrder?id=<%=orde._id %>"><img src="/ImageData/<%=orde.productId.image[0]%>" height="100" width="100" alt="" class="avatar-lg"></a>
													</div>
													
												
												</div>


												<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
													<div class="me-4">
														<img src="" alt="" class="avatar-lg">
													</div>
													<div class="flex-grow-1 align-self-center overflow-hidden">
														<div>
															<h5 class="text-truncate "><%=orde.productId.name %></h5>
															<% let total=0 %>
												
															<% total=orde.productPrice*orde.quantity %>
										
															<% total=Math.round(total/ 100 * (100 - order.offer)) %>
	
															<h6>₹<%=total%></h6>
														</div>
													</div>
													<div class="flex-shrink-0 ms-2">
														<ul class="list-inline mb-0 font-size-16">
															<li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Remove">
																<a href="#" class="text-muted px-1">
																	<i class="mdi mdi-trash-can-outline"></i>
																</a>
															</li>
															<li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Add Wishlist">
																<a href="#" class="text-muted px-1">
																	<i class="mdi mdi-heart-outline"></i>
																</a>
															</li>
														</ul>
													</div>
												</div>


												<div class="d-flex align-items-start border-bottom pb-3 col-md-4">
													<div class="me-4">
														<img src="assets/images/product/img-3.png" alt="" class="avatar-lg">
													</div>
													<div class="flex-grow-1 align-self-center overflow-hidden">
														<div>
															<h6 class="text-truncate "><%=order.payment%></h5>
																<p class="mb-1"><%=order.orderDate.toLocaleDateString()%></p>
																<p class="mb-1"><%=orde.ProductStatus%></p>
																<p class="mb-1"><%=order.paymentStatus%></p>
																
														</div>
													</div>
												
												</div>
												
												<br>
												<br>
											</div>
		
												<% }) %>
												<% }) %>
											
											</div>

										</div>

                                    </div><!-- .End .tab-pane -->
            
                                    <div class="tab-pane fade" id="tab-downloads" role="tabpanel" aria-labelledby="tab-downloads-link">
                                        <div class="password justify-content-center d-flex align-items-center ">
											<form action="/changepasswor" method="post">
											<div class="password2">
										
												<div class="password2">
													<input type="password" name="oldpass" placeholder="Old password"  required>
												</div>
												<div class="password2">
													<input type="password" placeholder="New  password" id="password" required>
												</div>
												<input type="password" name="confirmPass" placeholder="confirm password" id="confirmPassword" required>
											</div>
											<div class="justify-content-center d-flex">
												<input type="submit" value="save" style="background-color: rgb(39, 38, 38);width: 5rem;color: white;height: 2rem;border-radius: 20px;">
											</div>
											</form>
										</div>
                                    </div><!-- .End .tab-pane -->
            
                                    <div class="tab-pane fade" id="tab-address" role="tabpanel" id="staticBackdrop" aria-labelledby="tab-address-link">
										<h5>Address</h5> 
										<div class="d-flex justify-content-end "  >
											
											<button type="button" class="btn btn-dark" style="border-radius: 20px;font-size: 1vw;" data-toggle="modal" data-target="#exampleModal" >Add New +</button>
										</div>

										<% add.forEach((add)=>{%>
											<% if(add.address.length==0){ %>
												<div class="d-flex justify-content-center align-items-center h-75">
													<div>
												<img src="/image/nothing.png" alt="">
											
													</div>
												  </div>
												<% }else{ %>
											<% for(let i=0;i<add.address.length;i++){ %>
										<div  id="delet<%= add.address[i]._id%>" class="fullAdd d-flex justify-content-center p-3  ">
											<div class="addressDe p-3 ">
											
													<div class="d-flex  justify-content-end ">
														<div class="dropdown">
															<button  class="btn btn-white  border-0 " type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
															  Change
															</button>
															<div class="dropdown-menu" aria-labelledby="dropdownMenuButton" >
															  <a class="dropdown-item" data-toggle="modal" data-target="#example" onclick="edit('<%= add.address[i]._id%>')" >Edit</a>
															  <a class="dropdown-item" onclick="dele('<%= add.address[i]._id%>')" >Delete</a>
															</div>
														  </div>
													</div>
												
												<div>
													<p><span style="font-size: 1.4vw;"><%=add.address[i].name%></span></p>
													<p><span><%=add.address[i].place%></span>,<span><%=add.address[i].locality%></span>
														<br><span><%=add.address[i].city%></span>
														<br><span><%=add.address[i].state%>,</span>
														<span><%=add.address[i].pincode%> </span>
														<br>
														<br>
														<span>Phone: <%=add.address[i].phone%> </span>
												
													
													</p>
												</div>
											</div>
										</div>
										<% } %>
										<% } %>
										<% })  %>
										</div>
            
										<div class="tab-pane fade" id="tab-account" role="tabpanel" aria-labelledby="tab-account-link">
										
										<div class="w-100 " style="background-color: #fff;border-radius: 10px;">

											<div class="p-5 justify-content-center d-flex  ">
												<div class="walletBack     w-75 ">

													<div class="">
														
														<h4>Current Balance <samp>:  ₹<%=wallet?.balance %></samp></h4>
													</div>
													<br>
													<form action="/addWallet" method="post" id="myForm1">
													<div class="row">
													<div class="col-md-4">
														<input class="amount" id="amount" type="number" name="walletAdd" placeholder="Enter Amount" >
													</div>
												
													<div class="col-md-4 addButton">
														<button class="butt" type="button"  onclick="razorPay()">Add Money</button>
													</div>
												</div>
											</form>
													<div>
														<br>

													<br>
													<div class="select-menu">
														<div class="select">
														  <span>Histoy</span>
														  <i class="fas fa-angle-down"></i>
														</div>
														<div class="options-list">
												<table class="table  table-check">
													<thead>
														<tr>
															<td>Transactions</td>
															<td>Amount</td>
															<td>Date</td>
														</tr>
													</thead>
														<tbody>
															<% let sortedTransactions = wallet?.transaction.sort((a, b) => b.date - a.date); %>
															<% sortedTransactions.forEach((Data) => { %>
															  <tr>
																<td><%= Data.creditOrDebit %></td>
																<td>₹ <%= Data.amount %></td>
																<td><%= Data.date.toLocaleDateString() %></td>
															  </tr>
															<% }) %>															
													</tbody>
												</table>
														</div>
													  </div>
													  
													</div>
											</div>
										</div>
										</div>
										
										</div><!-- .End .tab-pane -->
										<div class="tab-pane fade" id="tab-coupon" role="tabpane2" aria-labelledby="tab-coupon-link">
											<div>
												<h4>Coupon</h4>
											</div>
											<br>
											<div class="row">
												
												<% if(couponlist.coupons.length==0){ %>
													<div class="d-flex justify-content-center align-items-center h-75">
														<div>
													<img src="/image/nothing.png" alt="">
												
														</div>
													  </div>
													<% }else{ %>
												<% couponlist?.coupons?.forEach((Data)=>{ %>
													
													
											<div class="col-lg-4 ">
												<div class="card" style="box-shadow:1px 1px 8px 0px #888888;">
													<img class="card-img img-fluid" src="<%=Data?.couponId?.image%>" alt="Card image">
													<div class="card-img-overlay">
														<h5 class="card-title text-dark "><%=Data.couponId.name %></h5>
														<div class=" ">
															<h2 class="text-dark" style="font-size: 20px;"><%=Data.couponId.offer %>%</h2>
														</div>
														<% if(Data.couponStatus==="Claimed"){ %>
															<span class="card-text text-dark">
																 <span class="text-danger"	>Claimed</span>
															</span>
														
														<% }else{ %>
																<p class="card-text text-dark" id="couponCode" onclick="copyCoupon()" style="cursor: pointer;">
																	Code: <span><%=Data.code %></span>
																</p>

															<% } %>
															<p class="card-text text-dark" style="font-size: 10px;">Valid Till: <%=Data.expiryDate.toLocaleDateString()%></p>
															<p class="card-text text-dark"  style="font-size: 10px;"> <%=Data.couponId.description%></p>
													
													</div>
												</div>
											</div>
											<% }) %>
											<% } %>

										</div>
										</div>

										<div class="tab-pane fade" id="tab-Wishlist" role="tabpane" aria-labelledby="tab-Wishlist-link">
								
											<div class="row">
												<% if(wishlists.products.length == 0) { %>
													<div style="height: 80vh;">
													  <div class="d-flex justify-content-center align-items-center h-100">
														<div>
													<img src="/image/em.png" alt="">
												
														</div>
													  </div>
													</div>
													<% } %>
												<% wishlists?.products?.forEach((wish)=>{ %>
														<div class="col-lg-4" id="remove<%=wish.productId._id%>">
														
															<div class="w-100 h-25 ">
															
																		<!-- Single-product start -->
																		<div class="single-product">
																			<div class="product-img">                        
																				
																			
																				<a href="/product?id=<%=wish.productId._id %>"><img src="/ImageData/<%=wish.productId.image[0]%>" height="250" width="100" style="max-width: 100%;" alt="heelloooooo"></a>
																				<div class="product-action clearfix justify-content-center d-flex ">
																					<a  data-bs-toggle="tooltip" data-placement="top" onclick="removeWishlist('<%=wish.productId._id%>')" title="Wishlist"><i class="ri-heart-3-fill" style="cursor: pointer;"></i></a>
																					<!-- <a href="#" data-bs-toggle="modal"  data-bs-target="#productModal" title="Quick View"><i class="zmdi zmdi-zoom-in"></i></a>
																					<a href="#" data-bs-toggle="tooltip" data-placement="top" title="Compare"><i class="zmdi zmdi-refresh"></i></a> -->
																					<% if(!wish.productId.quantity==0){ %>
																						<a onclick="addcart('<%=wish.productId._id%>')" data-bs-toggle="tooltip" data-placement="top" title="Add To Cart"><i class="zmdi zmdi-shopping-cart-plus" style="cursor: pointer;"></i></a>
																						
																						<% }else{ %>
																							<a data-bs-toggle="tooltip" data-placement="top" title="Add To Cart"><i di  class="zmdi zmdi-shopping-cart-plus" style="cursor: pointer;"></i></a>
																							<% } %>
																				</div>
																			</div>
																			<div class="product-info clearfix">
																				<div class="fix justify-content-center d-flex ">
																					<h4 class="post-title floatleft"><a href="#"><%=wish.productId.name%></a></h4>
																				</div>
																				<div class="fix">
																					<div class="d-flex " style="gap: 1rem;">
																						<!-- <span class="pro-price floatleft opacity-50  text-decoration-line-through">₹<</span>
																						<span class="pro-price floatleft">₹</span> -->
																					</div>
																					<!-- <span class="pro-rating floatright">
																						<a href="#"><i class="zmdi zmdi-star"></i></a>
																						<a href="#"><i class="zmdi zmdi-star"></i></a>
																						<a href="#"><i class="zmdi zmdi-star"></i></a>
																						<a href="#"><i class="zmdi zmdi-star-half"></i></a>
																						<a href="#"><i class="zmdi zmdi-star-half"></i></a>
																					</span> -->
																				</div>
																			</div>
																		</div>
																
																
															
								
										
																<!-- Single-product end -->
															</div>
														</div>
														
														<% }) %>
													
													</div>
												</div>
										</div><!-- .End .tab-pane -->
									</div>
                            </div><!-- End .col-lg-9 -->
                        </div><!-- End .row -->
                    </div><!-- End .container -->
                </div><!-- End .dashboard -->
            </div><!-- End .page-content -->
			
			<%- include('../layouts/user/Footer.ejs') %>
			<!-- FOOTER END -->
			<!-- QUICKVIEW PRODUCT -->
			<div id="quickview-wrapper">
			   <!-- Modal -->
			   <div class="modal fade" id="productModal" tabindex="-1" role="dialog">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							</div>
							<div class="modal-body">
								<div class="modal-product">
									<div class="product-images">
										<div class="main-image images">
											<img alt="#" src="img/product/quickview-photo.jpg"/>
										</div>
									</div><!-- .product-images -->

									<div class="product-info">
										<h1>Aenean eu tristique</h1>
										<div class="price-box-3">
											<hr />
											<div class="s-price-box">
												<span class="new-price">$160.00</span>
												<span class="old-price">$190.00</span>
											</div>
											<hr />
										</div>
										<a href="shop.html" class="see-all">See all features</a>
										<div class="quick-add-to-cart">
											<form method="post" class="cart">
												<div class="numbers-row">
													<input type="number" id="french-hens" value="3" min="1">
												</div>
												<button class="single_add_to_cart_button" type="submit">Add to cart</button>
											</form>
										</div>
										<div class="quick-desc">
											Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam fringilla augue nec est tristique auctor. Donec non est at libero.
										</div>
										<div class="social-sharing">
											<div class="widget widget_socialsharing_widget">
												<h3 class="widget-title-modal">Share this product</h3>
												<ul class="social-icons">
													<li><a target="_blank" title="Google +" href="#" class="gplus social-icon"><i class="zmdi zmdi-google-plus"></i></a></li>
													<li><a target="_blank" title="Twitter" href="#" class="twitter social-icon"><i class="zmdi zmdi-twitter"></i></a></li>
													<li><a target="_blank" title="Facebook" href="#" class="facebook social-icon"><i class="zmdi zmdi-facebook"></i></a></li>
													<li><a target="_blank" title="LinkedIn" href="#" class="linkedin social-icon"><i class="zmdi zmdi-linkedin"></i></a></li>
												</ul>
											</div>
										</div>
									</div><!-- .product-info -->
								</div><!-- .modal-product -->
							</div><!-- .modal-body -->
						</div><!-- .modal-content -->
					</div><!-- .modal-dialog -->
			   </div>
			   <!-- END Modal -->
			</div>
			<!-- END QUICKVIEW PRODUCT -->	
			
		</div>
		<!-- WRAPPER END -->

		<!-- all js here -->

	




<script>
	
    function checkPasswordMatch() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const errorSpan = document.getElementById('passwordMatchError');
        const submitBtn = document.getElementById('submitBtn');

        if (password === confirmPassword) {
            errorSpan.textContent = ''; // Clear error message
            submitBtn.disabled = false; // Enable submit button
        } else {
            errorSpan.textContent = 'Password and Confirm Password do not match';
            submitBtn.disabled = true; // Disable submit button
        }
    }

    // Attach the checkPasswordMatch function to the input events of both password fields
    document.getElementById('password').addEventListener('input', checkPasswordMatch);
    document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);


	const name1=document.getElementById(`name`)
	const phone1=document.getElementById(`phone`)
	const locality1=document.getElementById(`locality`)
	const pincode1=document.getElementById(`pincode`)
	const city1=document.getElementById(`city`)
	const state1=document.getElementById(`state`)
	const place1=document.getElementById(`place`)
	const id1=document.getElementById(`id`)
	

	                function edit(edit){
		               fetch('/editAddress', {
                                method: "put",
                                 headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ edit })



                            }).then((res)=> res.json())
							  .then((data)=>{
						
								const {name,phone,locality,pincode,place,city,state,_id}=data.editdata.address[0];
						console.log(name,phone,locality,pincode,place,city,state,_id);
								name1.value=name
								phone1.value=phone
								locality1.value=locality
								pincode1.value=pincode
								city1.value=city
								state1.value=state
								place1.value=place
								id1.value=_id

							})

	                   }
function dele(ID){
	const delet=document.getElementById(`delet${ID}`)
	fetch('/deleteAdderess', {
    method: "post",
    headers: {
        'Content-Type': 'application/json'
     },
         body: JSON.stringify({ ID })
     })
	 delet.remove()
}



const Editform = document.getElementById(`editAddressForm`);

if(Editform){
                            console.log('sjjsjs');
                            Editform.addEventListener('submit', function (event) {+
                                console.log('submit');
                                        const flag=validate(Editform,6,schema)
                    
                                        if (!flag) {
                                            event.preventDefault();
                                        }
                                    });


                        }


const schema = {
                    name: /^[a-zA-Z]+(?: [a-zA-Z]+)*$/,
                    phone: /^[0-9]{10}$/,
                    pincode: /^[0-9]{6}$/
                }

function validate(el,count,schema){
                    const inputs = el.querySelectorAll('input');
                    const submitBtn = document.getElementById('submitBtn');
                    let flag = true;
                    inputs.forEach((inp,i) => {
                       if(i<count){
                        const val = inp.value.trim();
                        const name = inp.name;
                        const test = schema[`${name}`] || { test: () => true }
                        if (val && test?.test(val)) removeNextElem(inp,name);
                        else {
                            createElement(inp, name)
                            flag = true;
                            event.preventDefault();  
                            return
                        }
                       }
                    })
               return flag
                }

                function createElement(elem, name) {
                const next= elem.nextElementSibling
                if(next?.id!==`${name}22`){
                    const pTag = document.createElement('p');
                    pTag.style.color = "red";
                    pTag.id = `${name}22`
                    pTag.textContent = `invalid ${name}`;
                    elem.parentNode.insertBefore(pTag, elem.nextSibling);
                    elem.style.border = "1px solid red"
                }
                }

                function removeNextElem(elem,name) {
                    console.log('remove');
                    const nextSibling = elem.nextElementSibling;
                    elem.style.border = '0px solid '
                    console.log(nextSibling,name,elem);
                if (nextSibling?.id==`${name}22`) nextSibling.parentNode.removeChild(nextSibling);
                }



	function removeWishlist(remove){
		const Remove=document.getElementById('remove'+remove)
		fetch('/wishlistremove', {
				method: "post",
					headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ remove})
			})
			Remove.remove()
	}





	function addcart(id) {
			const quantity = 1
			fetch('/addtocart', {
				method: "POST",
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ id, quantity })
			}).then(res => res.json())

				.then(data => {

					if (data.succ) {
						cartAction();
						const Toast = Swal.mixin({

							toast: true,
							position: "bottom",
							showConfirmButton: false,
							timer: 3000,
							timerProgressBar: true,

							didOpen: (toast) => {
								toast.onmouseenter = Swal.stopTimer;
								toast.onmouseleave = Swal.resumeTimer;
							}
						});

						Toast.fire({

							icon: "success",
							title: "Added TO Cart"

						});

					} else if (data.fail) {

						const Toast = Swal.mixin({

							toast: true,
							position: "bottom",
							showConfirmButton: false,
							timer: 3000,
							timerProgressBar: true,

							didOpen: (toast) => {

								toast.onmouseenter = Swal.stopTimer;
								toast.onmouseleave = Swal.resumeTimer;
							}

						});

						Toast.fire({

							icon: "warning",
							title: "Already Added"

						});

					}


				})
		}






		function copyCoupon() {
    var couponElement = document.getElementById("couponCode").querySelector("span");

    var tempInput = document.createElement("input");
    tempInput.value = couponElement.textContent;
    document.body.appendChild(tempInput);
    tempInput.select();
    tempInput.setSelectionRange(0, 99999); 

    document.execCommand("copy");
    document.body.removeChild(tempInput);

    const Toast = Swal.mixin({
        toast: true,
        position: "bottom",
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
    });

    Toast.fire({
        icon: "success",
        title: "Coupon Code copied"
    });
}



</script>
<style>
	.swal2-popup{
		background-color: #ffffff93 !important;
		box-shadow: 0 0 0 0 black;
backdrop-filter: blur(1rem) !important;
border-radius: 12px !important;
}
.swal2-success-circular-line-left{
display: none;
}
.swal2-success-circular-line-right{
display: none;
}
.swal2-success-fix{
display: none;
}
.swal2-timer-progress-bar{
border-radius: 20px;
background-color: #b79bb263;
}
	
</style>
<style>
	.amount{

		width: 100%;
		height: 3rem;
		border-radius: 10px;
		background-color: rgb(234, 234, 234);
		border: 0;
	}
	


body {

  height: 100vh;

}

.select-menu {
  width: 300px;
  cursor: pointer;
  position: relative;
}

.select {
  border: 1px solid;
  padding: 10px;
  color: #928b8b;
  font-weight: 500;
  border-radius: 6px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  


  -webkit-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
}

.options-list {
  position: absolute;
  width: 100%;
  background-color: #f9f9f9;
  border-radius: 6px;

  padding: 0 20px;

  overflow-y: auto;
  -webkit-transition: .4s linear .2s;
  -o-transition: .4s linear .2s;
  transition: .4s linear .2s;
  height: 0;
}

.option {
  padding: 8px 0;
  font-weight: 500;
  font-size: 14px;
  -webkit-transition: .3s ease-in-out;
  -o-transition: .3s ease-in-out;
  transition: .3s ease-in-out;
}



.options-list::-webkit-scrollbar {
  width: 4px;
  background-color: #eee;
}



.options-list.active {
  height: 180px;
}

	
</style>

<script>
	 const select = document.querySelector(".select");
    const options_list = document.querySelector(".options-list");
    const options = document.querySelectorAll(".option");

    //show & hide options list
    select.addEventListener("click", () => {
      options_list.classList.toggle("active");
      select.querySelector(".fa-angle-down").classList.toggle("fa-angle-up");
    });

    //select option
    options.forEach((option) => {
      option.addEventListener("click", () => {
        options.forEach((option) => { option.classList.remove('selected') });
        select.querySelector("span").innerHTML = option.innerHTML;
        option.classList.add("selected");
        options_list.classList.toggle("active");
        select.querySelector(".fa-angle-down").classList.toggle("fa-angle-up");
      });
    });




	function razorPay() {
		const form = document.getElementById('myForm1')
		const amount=document.getElementById('amount')
	
            fetch('/razorPay', {
                method: 'POST',
                headers: { 'Content-type': 'application/json' },
                body: JSON.stringify({ amount:amount.value })
            }).then(res => res.json()).then(data => {
                if (data.succes) {
                  
                    let options = {
                        "key": `${data.key_id}`,
                        "amount": `${data.amount}`,
                        "currency": "INR",
                        "name": "slayFIt",
                        "handler": function (response) {
                            form.submit();
                        },
                        "profile": {
                            "name": `${data.name}`,
                            "email": `${data.email}`
                        }
                    }

                    let razorpayObject = new Razorpay(options);
                    razorpayObject.on('payment.failed', (response) => {
                        alert('payment failed');
                    });
                    razorpayObject.open();
                }else if(data.fail){
                    const Toast = Swal.mixin({

                    toast: true,
                    position: "bottom",
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,

                    didOpen: (toast) => {

                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }

                    });

                    Toast.fire({

                    icon: "warning",
                    title: "No address",
                    background:"31363F"

                    })
                }
            })
        }

function validateAddress(){
	let name = document.getElementById('first-name').value.trim();
	let mobile  = document.getElementById('mobile-no').value.trim();
	let locality = document.getElementById('localitys').value.trim();
	let pincode = document.getElementById('pincodes').value.trim();
	let address = document.getElementById('address').value.trim();
	let city = document.getElementById('citys').value.trim();
	let state = document.getElementById('states').value.trim();


	let nameError = document.getElementById('nameError');
	let mobileError = document.getElementById('mobileError');
	let localityError = document.getElementById('localityError');
	let pincodeError = document.getElementById('pincodeError');
	let addressError = document.getElementById('addressError');
	let cityError = document.getElementById('cityError');
	let stateError =document.getElementById('stateError');

	nameError.textContent = '';
	mobileError.textContent = '';
	localityError.textContent = '';
	pincodeError.textContent = '';
	addressError.textContent = '';
	cityError.textContent = '';
	stateError.textContent = ''

	let isValied = true

	if(name === ''){
		nameError.textContent = 'Please enter your name'
		isValied = false
	}

	if(!/^\d{10}$/.test(mobile)) {
		mobileError.textContent = 'Please enter a valied 10-digit mobile number'
		isValied = false
	}

	if(locality === ''){
		localityError.textContent = 'Please enter your locality'
		isValied = false
	}

	if(!/^\d{6}$/.test(pincode)){
		pincodeError.textContent = 'Please enter a valied 6-digit pincode'
		isValied = false
	}

	if(address === ''){
		addressError.textContent = 'Please enter your Address'
		isValied = false
	}

	if(city === ''){
		cityError.textContent = 'Please enter your City'
		isValied = false
	}
	if(state === ''){
		stateError.textContent = 'Please enter your State'
		isValied = false
	}

	return isValied

}


function Repayment(amount) {
		const form = document.getElementById('myFormRepayment')
		const Status=document.getElementById('Status')
	
	
            fetch('/Repayment', {
                method: 'POST',
                headers: { 'Content-type': 'application/json' },
                body: JSON.stringify({ amount })
            }).then(res => res.json()).then(data => {
                if (data.succes) {
                  
                    let options = {
                        "key": `${data.key_id}`,
                        "amount": `${data.amount}`,
                        "currency": "INR",
                        "name": "slayFIt",
                        "handler": function (response) {
							Status.value="Paid"
                            form.submit();
                        },
                        "profile": {
                            "name": `${data.name}`,
                            "email": `${data.email}`
                        }
                    }

                    let razorpayObject = new Razorpay(options);
                    razorpayObject.on('payment.failed', (response) => {
                        alert('payment failed');
						Status.value="Pending"
						form.submit();
                    });
                    razorpayObject.open();
                }else if(data.fail){
                    const Toast = Swal.mixin({

                    toast: true,
                    position: "bottom",
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,

                    didOpen: (toast) => {

                        toast.onmouseenter = Swal.stopTimer;
                        toast.onmouseleave = Swal.resumeTimer;
                    }

                    });

                    Toast.fire({

                    icon: "warning",
                    title: "No address",
                    background:"31363F"

                    })
                }
            })
        }


</script>

<%- include('../layouts/user/lyFooter.ejs') %>